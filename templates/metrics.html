<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dynamic Metrics Table</title>
  <style>
    body { background: #000; color: #fff; font-family: sans-serif; text-align: center; padding-top: 100px; }
    button { background: #0069d9; color: #fff; border: none; padding: 1em 2em; font-size: 1.2em; cursor: pointer; border-radius: 5px; }
    table { margin: 2em auto; border-collapse: collapse; width: 80%; }
    th, td { padding: 0.5em 1em; border: 1px solid #444; }
  </style>
</head>
<body>
  <h1>Dynamic Metrics Table</h1>
  <label>
    Start date: <input type="date" id="start" value="2025-01-01"/>
  </label>
  <label>
    End date: <input type="date" id="end" value="2025-06-19"/>
  </label>
  <br/><br/>
  <button id="btn">Create</button>

  <div id="table"></div>

  <script>
    document.getElementById("btn").onclick = async () => {
      const s = document.getElementById("start").value;
      const e = document.getElementById("end").value;
      const res = await fetch(`/metrics?start_date=${s}&end_date=${e}`);
      const data = await res.json();
      if (res.status !== 200) {
        document.getElementById("table").innerText = "Ошибка: " + data.detail;
        return;
      }
      let html = `<table>
        <tr><th>Метрика</th><th>Значение</th></tr>
        <tr><td>Total learners</td><td>${data.total_learners}</td></tr>
        <tr><td>Total logs</td><td>${data.total_logs}</td></tr>
        <tr><td>Total outcomes</td><td>${data.total_outcomes}</td></tr>
        <tr><td colspan="2"><b>By recommendation_method</b></td></tr>`;
      for (const [method, cnt] of Object.entries(data.learners_by_method)) {
        html += `<tr><td>${method}</td><td>${cnt}</td></tr>`;
      }
      html += `</table>`;
      document.getElementById("table").innerHTML = html;
    };
  </script>
</body>
</html>
